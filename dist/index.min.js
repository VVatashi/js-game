(()=>{var lt=Object.defineProperty;var ct=(o,e,t)=>e in o?lt(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var J=(o,e,t)=>ct(o,typeof e!="symbol"?e+"":e,t);var ce=class{constructor(){let e=new AudioContext,t=e.createGain();t.connect(e.destination),t.gain.value=.2,this.context=e,this.gainNode=t}resume(){let{context:e}=this;return e.resume(),this}suspend(){let{context:e}=this;return e.suspend(),this}play(e,t=!1){let{context:r,gainNode:n}=this,i=r.createBufferSource();return i.buffer=e,i.loop=t,i.connect(n),i.start(),this}};var he=class{constructor(e,t,r){let n=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,n),e.renderbufferStorageMultisample(e.RENDERBUFFER,e.getParameter(e.MAX_SAMPLES),e.RGBA8,t,r),this.context=e,this.handle=n,this.width=t,this.height=r}bind(){let{context:e,handle:t}=this;return e.bindRenderbuffer(e.RENDERBUFFER,t),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteRenderbuffer(t),this.handle=null)}},H=class{constructor(e,t,r){let n=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,n),e.viewport(0,0,t,r),e.bindFramebuffer(e.FRAMEBUFFER,null),this.context=e,this.handle=n,this.width=t,this.height=r}attachTexture(e){let{context:t,attachment:r}=this;return this.bind(),e.bind(),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.handle,0),this.attachment=e,this.unbind(),r?.delete(),this}attachRenderbuffer(e){let{context:t,attachment:r}=this;return this.bind(),e.bind(),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,e.handle),this.attachment=e,this.unbind(),r?.delete(),this}resize(e,t){let{context:r}=this;return this.bind(),r.viewport(0,0,e,t),this.unbind(),this.width=e,this.height=t,this}bind(){let{context:e,handle:t}=this;return e.bindFramebuffer(e.FRAMEBUFFER,t),this}unbind(){let{context:e}=this;return e.bindFramebuffer(e.FRAMEBUFFER,null),this}blit(e){let{context:t,width:r,height:n}=this;return t.bindFramebuffer(t.READ_FRAMEBUFFER,this.handle),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,e.handle),t.blitFramebuffer(0,0,r,n,0,0,e.width,e.height,t.COLOR_BUFFER_BIT,t.LINEAR),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteFramebuffer(t),this.handle=null)}},de=class{constructor(e,t,r){let n=e.createShader(t);if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error("Can't compile shader: "+e.getShaderInfoLog(n));this.context=e,this.handle=n}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteShader(t),this.handle=null)}},W=class{constructor(e,t,r){let n=new de(e,e.VERTEX_SHADER,t),i=new de(e,e.FRAGMENT_SHADER,r),s=e.createProgram();if(e.attachShader(s,n.handle),e.attachShader(s,i.handle),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS))throw new Error("Can't link shader program: "+e.getProgramInfoLog(s));n.delete(),i.delete(),this.context=e,this.handle=s,this.uniformLocationCache={}}bind(){let{context:e,handle:t}=this;return e.useProgram(t),this}getUniformLocation(e){let{context:t,handle:r,uniformLocationCache:n}=this;return e in n?n[e]:n[e]=t.getUniformLocation(r,e)}setUniform(e,t){let{context:r}=this;this.bind();let n=this.getUniformLocation(e);return typeof t=="boolean"?r.uniform1i(n,t?1:0):r.uniform1f(n,t),this}setUniformInteger(e,t){let{context:r}=this;this.bind();let n=this.getUniformLocation(e);return r.uniform1i(n,t),this}setUniformMatrix(e,t,r=!1){let{context:n}=this;this.bind();let i=this.getUniformLocation(e);return n.uniformMatrix4fv(i,r,t),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteProgram(t),this.handle=null)}},j=class{constructor(e,t,r,n,i=e.RGBA8){let s=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(t,s),e.texImage2D(t,0,i,r,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(t,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(t,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(t,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.LINEAR),this.context=e,this.handle=s,this.type=t}bind(e=0){let{context:t,handle:r,type:n}=this;return t.activeTexture(e+t.TEXTURE0),t.bindTexture(n,r),this}setImage(e){let{context:t,type:r}=this;return this.bind(),t.texSubImage2D(r,0,0,0,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(r,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.generateMipmap(r),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteTexture(t),this.handle=null)}},Se=class{constructor(e,t,r,n=e.STATIC_DRAW){let i=e.createBuffer();e.bindBuffer(t,i),e.bufferData(t,r,n),this.context=e,this.handle=i,this.type=t,this.usage=n}bind(){let{context:e,handle:t,type:r}=this;return e.bindBuffer(r,t),this}setData(e){let{context:t,type:r}=this;return this.bind(),t.bufferData(r,e,this.usage),this}setDataRange(e,t,r){let{context:n,type:i}=this;return this.bind(),n.bufferSubData(i,t,e,0,r),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteBuffer(t),this.handle=null)}},ee=class{constructor(e,t,r,n,i){this.elements=e,this.type=t,this.normalized=r,this.stride=n,this.offset=i}},Ee=class{constructor(e,t,r){let n=e.createVertexArray();e.bindVertexArray(n),t.bind();for(let i=0;i<r.length;i++){e.enableVertexAttribArray(i);let s=r[i];e.vertexAttribPointer(i,s.elements,s.type,s.normalized,s.stride,s.offset)}e.bindVertexArray(null),this.context=e,this.handle=n}bind(){let{context:e,handle:t}=this;return e.bindVertexArray(t),this}unnbind(){let{context:e}=this;return e.bindVertexArray(null),this}draw(e){let{context:t}=this;return this.bind(),t.drawArrays(t.TRIANGLES,0,e),this.unnbind(),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteVertexArray(t),this.handle=null)}},Te=class{constructor(e,t,r,n=e.STATIC_DRAW){let i=0;for(let c of r)i+=c.elements;let s=new Se(e,e.ARRAY_BUFFER,new Float32Array(i*t),n),l=new Ee(e,s,r);this.context=e,this.vertexCount=t,this.vertexArray=l,this.vertexBuffer=s}setData(e){return this.vertexBuffer.setData(e),this}setDataRange(e,t,r){return this.vertexBuffer.setDataRange(e,t,r),this}draw(e=null){return this.vertexArray.draw(e||this.vertexCount),this}delete(){this.vertexArray.delete(),this.vertexBuffer.delete()}},ue=class{constructor(){this.glyphs={}}deserializeDataFromCSV(e,t,r){let n=e.split(`
`);for(let i of n){let s=i.split(",");if(s.length!==10)continue;let l=Number(s[0]),c=Number(s[1]),h=Number(s[2]),u=1-Number(s[3]),b=Number(s[4]),g=1-Number(s[5]),m=Number(s[6])/t,w=1-Number(s[7])/r,d=Number(s[8])/t,p=1-Number(s[9])/r;this.glyphs[l]={charCode:l,advance:c,planeLeft:h,planeBottom:u,planeRight:b,planeTop:g,atlasLeft:m,atlasBottom:w,atlasRight:d,atlasTop:p}}return this}deserializeData(e){let t=new Float32Array(e),r=0,n=t[r++];for(let i=0;i<n;i++){let s=t[r++],l=t[r++],c=t[r++],h=t[r++],u=t[r++],b=t[r++],g=t[r++],m=t[r++],w=t[r++],d=t[r++];this.glyphs[s]={charCode:s,advance:l,planeLeft:c,planeBottom:h,planeRight:u,planeTop:b,atlasLeft:g,atlasBottom:m,atlasRight:w,atlasTop:d}}return this}serializeData(){let e=Object.values(this.glyphs),t=[e.length];for(let r of e){let{charCode:n,advance:i,planeLeft:s,planeBottom:l,planeRight:c,planeTop:h,atlasLeft:u,atlasBottom:b,atlasRight:g,atlasTop:m}=r;t.push(n,i,s,l,c,h,u,b,g,m)}return new Float32Array(t)}},fe=class{constructor(e,t,r){J(this,"MAX_VERTICES",65535);J(this,"VERTEX_ELEMENTS",8);this.context=e,this.vertices=new Float32Array(this.VERTEX_ELEMENTS*this.MAX_VERTICES),this.mesh=new Te(e,this.MAX_VERTICES,[new ee(2,e.FLOAT,!1,8*4,0),new ee(2,e.FLOAT,!1,8*4,2*4),new ee(4,e.FLOAT,!1,8*4,4*4)],e.DYNAMIC_DRAW),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.resize(t,r)}resize(e,t){return this.width=e,this.height=t,this.matrix=this.createOrthographicOffCenter(0,e,t,0,-1,1),this}createOrthographicOffCenter(e,t,r,n,i,s){let l=1/(e-t),c=1/(r-n),h=1/(i-s),u=-2*l,b=-2*c,g=2*h,m=(e+t)*l,w=(n+r)*c,d=(s+i)*h;return[u,0,0,0,0,b,0,0,0,0,g,0,m,w,d,1]}clear(e,t,r,n){let{context:i}=this;return i.clearColor(e,t,r,n),i.clear(i.COLOR_BUFFER_BIT),this}beginGeometry(){return this.vertexCount=0,this}endGeometry(){let{VERTEX_ELEMENTS:e,vertexCount:t,vertices:r}=this;if(t!==0)return this.mesh.setDataRange(r,0,e*t),this.mesh.draw(t),this}addVertex(e,t,r,n,i,s,l,c){let{VERTEX_ELEMENTS:h,vertexCount:u,vertices:b}=this;for(let g=0;g<h;g++)b[h*u+g]=arguments[g];return this.vertexCount++,this}drawTriangle(e,t,r,n,i,s,l,c,h,u,b,g,m,w,d,p){let{MAX_VERTICES:y,vertexCount:O}=this;return O+3>=y&&this.endGeometry().beginGeometry(),this.addVertex(e,t,r,n,m,w,d,p).addVertex(i,s,l,c,m,w,d,p).addVertex(h,u,b,g,m,w,d,p)}drawQuad(e,t,r,n,i,s,l,c,h,u,b,g,m,w,d,p,y,O,M,U){return this.drawTriangle(e,t,r,n,i,s,l,c,h,u,b,g,y,O,M,U).drawTriangle(e,t,r,n,h,u,b,g,m,w,d,p,y,O,M,U)}drawRectangle(e,t,r,n,i,s,l,c,h,u,b,g){let m=e,w=t,d=e+r,p=t,y=e+r,O=t+n,M=e,U=t+n;return this.drawQuad(m,w,i,s,d,p,l,s,y,O,l,c,M,U,i,c,h,u,b,g)}drawRectangleOffCenter(e,t,r,n,i,s,l,c,h,u,b,g){let m=r/2,w=n/2,d=e-m,p=t-w,y=e+m,O=t-w,M=e+m,U=t+w,Z=e-m,le=t+w;return this.drawQuad(d,p,i,s,y,O,l,s,M,U,l,c,Z,le,i,c,h,u,b,g)}drawRotatedRectangleOffCenter(e,t,r,n,i,s,l,c,h,u,b,g,m){let w=r/2,d=n/2,p=Math.sin(i),y=Math.cos(i),O=-w,M=-d,U=w,Z=-d,le=w,Ue=d,Ge=-w,ze=d,et=e+y*O-p*M,tt=t+p*O+y*M,nt=e+y*U-p*Z,rt=t+p*U+y*Z,it=e+y*le-p*Ue,st=t+p*le+y*Ue,ot=e+y*Ge-p*ze,at=t+p*Ge+y*ze;return this.drawQuad(et,tt,s,l,nt,rt,c,l,it,st,c,h,ot,at,s,h,u,b,g,m)}drawChar(e,t,r,n,i,s,l,c,h){let u=e.glyphs[n];return typeof u>"u"||u===null?this:this.drawRectangle(t+i*u.planeLeft,r+i*u.planeTop,i*(u.planeRight-u.planeLeft),i*(u.planeBottom-u.planeTop),u.atlasLeft,u.atlasTop,u.atlasRight,u.atlasBottom,s,l,c,h)}drawString(e,t,r,n,i,s,l,c,h){let u=0;for(let b=0;b<n.length;b++){let g=n.charCodeAt(b),m=e.glyphs[g];typeof m>"u"||m===null||(this.drawChar(e,t+u,r,g,i,s,l,c,h),u+=i*m.advance)}return this}drawStringOffCenter(e,t,r,n,i,s,l,c,h){let u=this.measureString(e,n,i);return this.drawString(e,t-u/2,r,n,i,s,l,c,h)}measureString(e,t,r){let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i),l=e.glyphs[s];typeof l>"u"||l===null||(n+=r*l.advance)}return n}delete(){this.mesh.delete()}},ge=class{constructor(e){this.renderer=e,this.buckets=new Map}begin(){return this.buckets.clear(),this}end(){for(let[e,t]of this.buckets.entries()){e.bind(),this.renderer.beginGeometry();for(let{name:r,args:n}of t)this.renderer[r](...n);this.renderer.endGeometry()}return this}addCommand(e,t,r){let n={name:t,args:r};return this.buckets.has(e)?this.buckets.get(e).push(n):this.buckets.set(e,[n]),this}drawTriangle(e,t,r,n,i,s,l,c,h,u,b,g,m,w,d,p,y){return this.addCommand(e,"drawTriangle",[...arguments].slice(1))}drawQuad(e,t,r,n,i,s,l,c,h,u,b,g,m,w,d,p,y,O,M,U,Z){return this.addCommand(e,"drawQuad",[...arguments].slice(1))}drawRectangle(e,t,r,n,i,s,l,c,h,u,b,g,m){return this.addCommand(e,"drawRectangle",[...arguments].slice(1))}drawRectangleOffCenter(e,t,r,n,i,s,l,c,h,u,b,g,m){return this.addCommand(e,"drawRectangleOffCenter",[...arguments].slice(1))}drawRotatedRectangleOffCenter(e,t,r,n,i,s,l,c,h,u,b,g,m,w){return this.addCommand(e,"drawRotatedRectangleOffCenter",[...arguments].slice(1))}drawChar(e,t,r,n,i,s,l,c,h,u){return this.addCommand(e,"drawChar",[...arguments].slice(1))}drawString(e,t,r,n,i,s,l,c,h,u){return this.addCommand(e,"drawString",[...arguments].slice(1))}drawStringOffCenter(e,t,r,n,i,s,l,c,h,u){return this.addCommand(e,"drawStringOffCenter",[...arguments].slice(1))}measureString(e,t,r){return this.renderer.measureString(e,t,r)}};var ve=class{get objectType(){return"GameObject"}update(e){}draw(){}},xe=class xe extends ve{get objectType(){return"Ball"}constructor(e,t,r,n,i,s){super(),this.x=e,this.y=t,this.offsetX=0,this.offsetY=0,this.radius=r,this.velocityX=n,this.velocityY=i,this.type=s}update(e){if(super.update(e),!k)if((x==="idle"||x==="shot")&&(this.x+=this.velocityX*e,this.y+=this.velocityY*e),S!==null&&x==="shot"){let t=S.x-this.x,r=S.y-this.y,n=Re(t,r),[i,s]=ae(t,r);n<30?(this.offsetX=.9*this.offsetX+.1*(-250/(t*t+r*r)*i),this.offsetY=.9*this.offsetY+.1*(-250/(t*t+r*r)*s)):(this.offsetX*=.975,this.offsetY*=.975)}else this.offsetX*=.975,this.offsetY*=.975}draw(){super.draw();let e=_[xe.types[this.type].texture],[t,r]=B(this.x,this.y),[n,i]=N(2*this.radius,2*this.radius);f.drawRectangleOffCenter(e,t+this.offsetX,r+this.offsetY,n,i,0,0,1,1,1,1,1,1)}};J(xe,"types",[{texture:"ball0",score:1},{texture:"ball1",score:2},{texture:"ball2",score:3},{texture:"ball3",score:4},{texture:"ball4",score:5},{texture:"ball5",score:6},{texture:"ball6",score:7},{texture:"ball7",score:8}]);var F=xe,Ae=class extends F{get objectType(){return"Projectile"}constructor(e,t,r,n,i,s,l){super(e,t,r,n,i,s,l),this.angle=0}update(e){super.update(e),!k&&((this.x-this.radius<-C/2&&this.velocityX<0||this.x+this.radius>C/2&&this.velocityX>0)&&(this.velocityX=-this.velocityX,Xe()),x==="shot"&&(this.angle+=e/100))}draw(){let e=_[F.types[this.type].texture],[t,r]=B(this.x,this.y),[n,i]=N(2*this.radius,2*this.radius);f.drawRotatedRectangleOffCenter(e,t,r,n,i,this.angle,0,0,1,1,1,1,1,1)}},Oe=class extends F{get objectType(){return"Particle"}constructor(e,t,r,n,i,s,l){super(e,t,r,n,i,s,l),this.lifetime=250*Math.random()}update(e){super.update(e),!k&&(this.x+=this.velocityX*e,this.y+=this.velocityY*e,this.velocityY+=2e-6*e*e,this.lifetime-=e,(this.lifetime<=0||this.y-this.radius>100)&&q(this))}},pe=class extends F{get objectType(){return"FallingBall"}constructor(e,t,r,n,i,s,l){super(e,t,r,n,i,s,l),this.lifetime=5e3}update(e){super.update(e),!k&&(this.x+=this.velocityX*e,this.y+=this.velocityY*e,this.velocityY+=2e-6*e*e,this.lifetime-=e,(this.lifetime<=0||this.y-this.radius>100)&&q(this))}draw(){let e=_[F.types[this.type].texture],[t,r]=B(this.x,this.y),[n,i]=N(2*this.radius,2*this.radius),s=this.lifetime/5e3;f.drawRectangleOffCenter(e,t,r,n,i,0,0,1,1,1,1,1,s)}},De=class extends F{get objectType(){return"ExplodingBall"}constructor(e,t,r,n,i,s,l){super(e,t,r,n,i,s,l),this.lifetime=200}update(e){super.update(e),!k&&(this.x+=this.velocityX*e,this.y+=this.velocityY*e,this.radius*=1.05,this.lifetime-=e,(this.lifetime<=0||this.y-this.radius>100)&&q(this))}draw(){let e=_[F.types[this.type].texture],[t,r]=B(this.x,this.y),[n,i]=N(2*this.radius,2*this.radius),s=this.lifetime/200;f.drawRectangleOffCenter(e,t,r,n,i,0,0,1,1,1,1,1,s)}},ht=`#version 300 es

uniform mat4 matrix;

layout(location = 0) in vec2 position;
layout(location = 1) in vec2 texCoords;
layout(location = 2) in vec4 color;

out vec2 fragTexCoords;
out vec4 fragColor;

void main() {
    gl_Position = matrix * vec4(position, 0, 1);

    fragTexCoords = texCoords;
    fragColor = color;
}
`,dt=`#version 300 es

precision mediump float;

uniform sampler2D colorTexture;

in vec2 fragTexCoords;
in vec4 fragColor;

out vec4 color;

void main() {
    color = fragColor * texture(colorTexture, fragTexCoords);
}
`,ut=`#version 300 es

uniform mat4 matrix;

layout(location = 0) in vec2 position;
layout(location = 1) in vec2 texCoords;
layout(location = 2) in vec4 color;

out vec2 fragTexCoords;
out vec4 fragColor;

void main() {
    gl_Position = matrix * vec4(position, 0.0, 1.0);

    fragTexCoords = texCoords;
    fragColor = color;
}
`,ft=`#version 300 es

precision mediump float;

uniform sampler2D msdfTexture;
uniform float screenPxRange;
uniform float outlineBias;

in vec2 fragTexCoords;
in vec4 fragColor;

out vec4 color;

float median(float r, float g, float b) {
    return max(min(r, g), min(max(r, g), b));
}

void main() {
    vec4 msd = texture(msdfTexture, fragTexCoords);

    float hardDistance = median(msd.r, msd.g, msd.a);
    float softDistance = msd.a;

    float inner = screenPxRange * (hardDistance - 0.5) + 0.5;
    float outer = screenPxRange * (softDistance - 0.5 + outlineBias) + 0.5;

    float innerOpacity = clamp(inner, 0.0, 1.0);
    float outerOpacity = clamp(outer, 0.0, 1.0);

    color = fragColor * innerOpacity + vec4(vec3(0.0), 1.0) * outerOpacity;
}
`,gt=`#version 300 es

layout(location = 0) in vec2 position;
layout(location = 1) in vec2 texCoords;
layout(location = 2) in vec4 color;

out vec2 fragTexCoords;

void main() {
    gl_Position = vec4(position, 0, 1);

    fragTexCoords = texCoords;
}
`,mt=`#version 300 es

precision mediump float;

const float weight[5] = float[] (0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);

uniform sampler2D colorTexture;
uniform bool horizontal;

in vec2 fragTexCoords;

out vec4 color;

void main() {
    vec2 texelSize = 1.0 / vec2(textureSize(colorTexture, 0));
    vec3 result = texture(colorTexture, fragTexCoords).rgb * weight[0];

    if (horizontal) {
        for (int i = 1; i < 5; i++) {
            result += texture(colorTexture, fragTexCoords + vec2(texelSize.x * float(i), 0.0)).rgb * weight[i];
            result += texture(colorTexture, fragTexCoords - vec2(texelSize.x * float(i), 0.0)).rgb * weight[i];
        }
    } else {
        for (int i = 1; i < 5; i++) {
            result += texture(colorTexture, fragTexCoords + vec2(0.0, texelSize.y * float(i))).rgb * weight[i];
            result += texture(colorTexture, fragTexCoords - vec2(0.0, texelSize.y * float(i))).rgb * weight[i];
        }
    }

    color = vec4(result, 1.0);
}
`,bt=`#version 300 es

layout(location = 0) in vec2 position;
layout(location = 1) in vec2 texCoords;
layout(location = 2) in vec4 color;

out vec2 fragTexCoords;

void main() {
    gl_Position = vec4(position, 0.0, 1.0);

    fragTexCoords = texCoords;
}
`,pt=`#version 300 es

precision mediump float;

uniform sampler2D colorTexture;
uniform sampler2D blurTexture;

uniform float blurBrightness;

in vec2 fragTexCoords;

out vec4 color;

void main() {
    vec3 result = texture(colorTexture, fragTexCoords).rgb + blurBrightness * texture(blurTexture, fragTexCoords).rgb;
    color = vec4(pow(result, vec3(1.0 / 2.2)), 1.0);
}
`,L=null,R=null,Ce=null,Le=null,He=null,Fe=null,Be=null,_={},v=null,a=null,f=null,V=null,ye=null,ie=null,K=null,Y=null,be=[],yt=0,E=[],$=[],S=null,Q=0,x="start",A=4,C=45,I=1,P=0,_e=0,z=0,X=0,se=!1,k=!1,_t="puzzlebobble",We=null,te=[{textureName:"background_0",blurTextureName:"background_0_blur"},{textureName:"background_1",blurTextureName:"background_1_blur"},{textureName:"background_2",blurTextureName:"background_2_blur"}],ne=0,Ke=109,D={ru:{newGame:"\u041D\u043E\u0432\u0430\u044F \u0438\u0433\u0440\u0430",continue:"\u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C",level:"\u0423\u0440\u043E\u0432\u0435\u043D\u044C",win:"\u041F\u043E\u0431\u0435\u0434\u0430",fail:"\u041F\u043E\u0440\u0430\u0436\u0435\u043D\u0438\u0435",press:"\u041D\u0430\u0436\u043C\u0438\u0442\u0435",toStartGame:"\u0447\u0442\u043E\u0431\u044B \u043D\u0430\u0447\u0430\u0442\u044C \u0438\u0433\u0440\u0443",toContinue:"\u0447\u0442\u043E\u0431\u044B \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C"},en:{newGame:"New Game",continue:"Continue",level:"Level",win:"Win",fail:"Fail",press:"Press",toStartGame:"to start game",toContinue:"to continue"}},T="en";async function wt(o){return(await fetch(o)).arrayBuffer()}function Pe(o){return new Promise(e=>{let t=new Image;t.addEventListener("load",()=>e(t)),t.loading="eager",t.src=o})}async function G(o){let t=await(await fetch(o)).arrayBuffer();return Y.context.decodeAudioData(t)}function B(o,e){let t=a.width/2,r=-Ke,n=a.height/100;return[n*o+t,n*e+r]}function oe(o,e){let t=a.width/2,r=-Ke,n=a.height/100;return[(o-t)/n,(e-r)/n]}function N(o,e){let t=a.height/100;return[t*o,t*e]}function Qe(o,e){return o*o+e*e}function Re(o,e){return Math.sqrt(o*o+e*e)}function ae(o,e){let t=Re(o,e);return[o/t,e/t]}function $e(){let o=new Set;for(let e of E)e.objectType==="Ball"&&o.add(e.type);return[...o]}function xt(o,e,t){for(let r of o)if(Qe(e-r.x,t-r.y)<1.25*r.radius*r.radius)return r;return null}function Rt(o,e,t,r,n){let i=null,s=0;for(;i===null&&s<128;)i=xt(o,e,t),e+=r*A/2,t+=n*A/2,(e-A<-C/2||e+A>C/2)&&(r=-r),s++;return i}function qe(){let o=E.filter(n=>n.objectType==="Ball"),e=new Set,t=-5;for(let n=-10;n<10;n++){let[i,s]=ae(n,t),l=Rt(o,0,90,i,s);l!==null&&e.add(l)}let r=[];for(let n of[...e]){let i=Ze(n).length;for(let s=0;s<i;s++)r.push(n)}return r.map(n=>n.type)}function Ye(){let o=qe();if(o.length===0){let e=$e();return e.length===0?0:e[Math.floor(e.length*Math.random())]}return o[Math.floor(o.length*Math.random())]}function Me(){E=E.filter(t=>t!==S);let o=$e(),e=o.length>0&&o.includes(Q)?Q:Ye();Q=Ye(),E.push(S=new Ae(0,95,A,0,0,e))}function me(){E=[],$=[];let o=-I;for(let e=o;e<5;e++)for(let t=-2;t<(e%2?2:3);t++){let r=Math.floor(Math.min(I+3,F.types.length)*Math.random()),n=new F(2*A*t+(e%2?A:0),A+2*A*e,A,0,5e-4,r);E.push(n),e===o&&$.push(n)}ne=Math.floor(Math.random()*te.length),Q=qe(),Me()}function Ie(){let{clientWidth:o,clientHeight:e}=L;L.width=o,L.height=e,a.resize(o,e),V.resize(o,e).attachRenderbuffer(new he(R,o,e)),ye.resize(o,e).attachTexture(new j(R,R.TEXTURE_2D,o,e)),ie.resize(o,e).attachTexture(new j(R,R.TEXTURE_2D,o,e)),K.resize(o,e).attachTexture(new j(R,R.TEXTURE_2D,o,e))}async function ke(){if(L=document.getElementById("canvas"),L===null)return console.error("#canvas not found");if(R=L.getContext("webgl2",{antialias:!1}),R===null)return console.error("Can't create webgl context");Le=new W(R,ht,dt),He=new W(R,bt,pt),Fe=new W(R,ut,ft),Be=new W(R,gt,mt),a=new fe(R,L.width,L.height),f=new ge(a),V=new H(R,L.clientWidth,L.clientHeight),ye=new H(R,L.clientWidth,L.clientHeight),ie=new H(R,L.clientWidth,L.clientHeight),K=new H(R,L.clientWidth,L.clientHeight),await Promise.all([...["background_0","background_0_blur","background_1","background_1_blur","background_2","background_2_blur","ball0","ball1","ball2","ball3","ball4","ball5","ball6","ball7","blue_button00","circle_05","lang_en","lang_ru","rays","white"].map(n=>Pe(`./assets/${n}.png`).then(i=>_[n]=new j(R,R.TEXTURE_2D,i.width,i.height,R.SRGB8_ALPHA8).setImage(i))),Pe("./assets/font.png").then(n=>_.font=new j(R,R.TEXTURE_2D,n.width,n.height,R.RGBA8).setImage(n)),wt("./assets/font.bin").then(n=>v=new ue().deserializeData(n))]),document.addEventListener("visibilitychange",function(){document.hidden?(Y?.suspend(),k=!0):(Y?.resume(),k=!1)}),document.addEventListener("click",n=>{Y===null&&(Y=new ce,Y.resume(),Promise.all([G("./assets/impactGlass_light_000.mp3"),G("./assets/impactGlass_light_001.mp3"),G("./assets/impactGlass_light_002.mp3"),G("./assets/impactGlass_light_003.mp3"),G("./assets/impactGlass_light_004.mp3"),G("./assets/impactGlass_medium_000.mp3"),G("./assets/impactGlass_medium_001.mp3"),G("./assets/impactGlass_medium_002.mp3"),G("./assets/impactGlass_medium_003.mp3"),G("./assets/impactGlass_medium_004.mp3")]).then(l=>be=l));let[i,s]=B(-C/2,0);if(n.clientX>i+10&&n.clientX<i+10+64&&n.clientY>10&&n.clientY<74)return St();if(x==="menu"){z=n.clientX,X=n.clientY;let l=32,[c,h]=N(.8*C,0);z>a.width/2-c/2&&z<a.width/2+c/2&&(X>a.height/2-l-72/2&&X<a.height/2-l+72/2?x="idle":X>a.height/2+l*2-72/2&&X<a.height/2+l*2+72/2&&(I=1,P=0,_e=0,x="idle",me()))}else x==="start"?x="idle":["win","fail"].includes(x)&&(typeof window.yandexGamesSDK<"u"?(Y?.suspend(),k=!0,window.yandexGamesSDK.adv.showFullscreenAdv({callbacks:{onClose(){me(),Y?.resume(),k=!1,x="start"},onError(l){console.error(l)}}})):(me(),x="start"))}),document.addEventListener("contextmenu",n=>n.preventDefault()),document.addEventListener("pointerdown",n=>{n.preventDefault();let[i,s]=B(-C/2,0);if(n.clientX>i+10&&n.clientX<i+10+64&&n.clientY>10&&n.clientY<74)return;z=n.clientX,X=n.clientY;let[l,c]=oe(z,X);se=n.button===0&&c<90}),document.addEventListener("pointermove",n=>{n.preventDefault();let[i,s]=B(-C/2,0);if(n.clientX>i+10&&n.clientX<i+10+64&&n.clientY>10&&n.clientY<74)return;z=n.clientX,X=n.clientY;let[l,c]=oe(z,X);se=n.buttons===1&&c<90}),document.addEventListener("pointerup",n=>{n.preventDefault();let[i,s]=B(-C/2,0);if(n.clientX>i+10&&n.clientX<i+10+64&&n.clientY>10&&n.clientY<74)return;z=n.clientX,X=n.clientY;let[l,c]=oe(z,X);if(x==="idle"&&n.button===0&&c<90){x="shot";let h=l,u=Math.min(c,95)-100,[b,g]=ae(h,u),m=.05;S.velocityX=b*m,S.velocityY=g*m}else if(x==="idle"&&(n.button===2||n.button===0&&c>=90)){let h=S.type;S.type=Q,Q=h}se=!1}),Ie(),addEventListener("resize",Ie);let o=navigator.language.slice(0,2).toLowerCase();console.log(`Device language: ${o}`),we(o),requestAnimationFrame(Je);let e=Number(localStorage.getItem("last_difficulty")||0);e>1&&(I=e,x="menu");let t=Number(localStorage.getItem("last_score")||0);t>0&&(P=t,_e=t),me(),console.log("Game ready"),await window.yandexGamesSDKPromise,window.yandexGamesSDK.features.LoadingAPI?.ready(),console.log("Yandex Games SDK ready");let r=window.yandexGamesSDK.environment.i18n.lang;console.log(`SDK language: ${r}`),we(r),window.yandexGamesSDK.getPlayer({scopes:!1}).then(n=>We=n)}function we(o){Object.keys(D).includes(o)?T=o:["be","kk","uk","uz"].includes(o)?T="ru":T="en",console.log(`Language changed to ${T}`)}function St(){let o=Object.keys(D),e=o.findIndex(t=>t===T);e===-1||e===o.length-1?we(o[0]):we(o[e+1])}function je(o,e=[]){let t=new Set([o]),r=new Set,n=[o];for(;n.length>0;){let i=n.pop(),s=Ne(i).filter(l=>!e.includes(l));for(let l of s)r.has(l)||(t.add(l),n.push(l)),r.add(l)}return[...t]}function Ze(o){let e=new Set([o]),t=new Set,r=[o];for(;r.length>0;){let n=r.pop(),i=Ne(n);for(let s of i)!t.has(s)&&s.type===n.type&&(e.add(s),r.push(s)),t.add(s)}return[...e]}function Ne(o){let e=[];for(let t of E){if(t.objectType!=="Ball"||t===o)continue;Re(o.x-t.x,o.y-t.y)<(t.radius+o.radius)*1.25&&e.push(t)}return e}function Xe(){be.length!==0&&Y.play(be[yt++%be.length])}var re=new Set;function q(o){re.add(o)}var Et=1e3/30;function Je(o){requestAnimationFrame(Je);let e=Math.min(Ce!==null?o-Ce:0,Et);Ce=o;for(let t of E)t.update(e);if(x==="idle"){let t=0,r=E.filter(s=>s.objectType==="Ball");for(let s of r)s.y>t&&(t=s.y);let[n,i]=oe(0,0);if(t<i+4*A&&t<50)for(let s of r)s.y+=e/100}if(x==="shot")for(let t of E){if(t.objectType!=="Ball")continue;let r=S.x-t.x,n=S.y-t.y;if(Re(r,n)<(t.radius+S.radius)*.9){let s=t.x,l=t.y;n*n>r*r?(s+=r>0?t.radius:-t.radius,l+=2*t.radius):s+=r>0?2*t.radius:-2*t.radius,Xe();let c=new F(s,l,t.radius,t.velocityX,t.velocityY,S.type);E.push(c);let h=new Set(Ze(c));if(h.size>2){for(let d of[...h]){q(d),P+=F.types[d.type].score,E.push(new De(d.x,d.y,A,d.velocityX,d.velocityY,d.type));for(let p=0;p<10;p++){let y=2*Math.random()-1,O=2*Math.random()-1;[y,O]=ae(y,O),y*=.025,O*=.025;let M=A*.25;E.push(new Oe(d.x,d.y,M,y,O,d.type))}}let u=0;for(let d of[...h])u+=50+Math.random()*50,setTimeout(Xe,u);let b=new Set;for(let d of[...h]){let p=Ne(d).filter(y=>!h.has(y));for(let y of p)b.add(y)}let g=new Set,m=new Set($.filter(d=>!h.has(d)));for(let d of[...b]){let p=je(d,[...h]);if(p.filter(y=>m.has(y)).length===0)for(let y of p)g.add(y)}if(g.size)for(let d of[...g]){q(d),P+=F.types[d.type].score;let p=(2*Math.random()-1)*.001,y=d.velocityY;E.push(new pe(d.x,d.y,A,p,y,d.type))}let w=new Set;for(let d of $.filter(p=>!h.has(p)).filter(p=>!g.has(p)))je(d,[...h,...g]).length===1&&w.add(d);if(w.size)for(let d of[...w])q(d),P+=F.types[d.type].score,E.push(new pe(d.x,d.y,A,d.velocityX,d.velocityY,d.type))}setTimeout(Me),x="idle";break}}if(S!==null&&(S.y<0||S.y>100)&&(setTimeout(Me),x="idle"),re.size&&(E=E.filter(t=>!re.has(t)),$=$.filter(t=>!re.has(t)),re.clear()),x==="idle"){let t=E.filter(r=>r.objectType==="Ball");for(let r of t)if(r.y+r.radius>90){P=_e,x="fail";break}}if(x==="idle"&&E.filter(t=>["Ball","FallingBall","ExplodingBall","Particle"].includes(t.objectType)).length===0&&(I++,_e=P,localStorage.setItem("last_difficulty",I),localStorage.setItem("last_score",P),x="win",We!==null&&typeof window.yandexGamesSDK<"u"&&window.yandexGamesSDK.isAvailableMethod("leaderboards.setLeaderboardScore").then(t=>{t&&window.yandexGamesSDK.getLeaderboards().then(r=>r.setLeaderboardScore(_t,P))})),V.bind(),a.clear(Math.pow(.63,2.2),Math.pow(.88,2.2),Math.pow(.98,2.2),1),Le.bind().setUniformMatrix("matrix",a.matrix),x==="menu"){{f.begin();let r=_[te[ne].blurTextureName],n=a.height/100,i=a.width/2,s=a.height/2,l=4*C*n,c=2*a.height;f.drawRectangleOffCenter(r,i-l,s,l,c,0,0,1,1,1,1,1,1),f.drawRectangleOffCenter(r,i,s,l,c,0,0,1,1,1,1,1,1),f.drawRectangleOffCenter(r,i+l,s,l,c,0,0,1,1,1,1,1,1);let h=_[te[ne].textureName],[u,b]=N(C,0);f.drawRectangleOffCenter(h,a.width/2,a.height/2,u,a.height,0,0,1,1,1,1,1,1),f.end()}f.begin(),f.drawRectangle(_.white,0,0,a.width,a.height,0,0,1,1,0,0,0,.75),f.drawRotatedRectangleOffCenter(_.rays,a.width/2,a.height/2,a.height*.5,a.height*.5,o/1e4,0,0,1,1,1,1,1,.5),f.end();{let[r,n]=B(-C/2,0);f.begin(),f.drawRectangle(_[`lang_${T}`],r+10,10,64,64,0,0,1,1,1,1,1,1),f.end()}let t=32;{let[r,n]=N(.8*C,0);f.begin(),f.drawRectangleOffCenter(_.blue_button00,a.width/2,a.height/2-t*1,r,72,0,0,1,1,1,1,1,1),f.drawRectangleOffCenter(_.blue_button00,a.width/2,a.height/2+t*2,r,72,0,0,1,1,1,1,1,1),f.end()}v!==null&&(Fe.bind().setUniformMatrix("matrix",a.matrix).setUniform("screenPxRange",Math.max(2,t*8/40)).setUniform("outlineBias",.25),_.font.bind(),a.beginGeometry(),a.drawStringOffCenter(v,a.width/2,a.height/2-t*2.25,D[T].continue,t,1,1,1,1),a.drawStringOffCenter(v,a.width/2,a.height/2-t*1.25,D[T].level+" "+I,t*.75,1,1,1,1),a.drawStringOffCenter(v,a.width/2,a.height/2+t*1.25,D[T].newGame,t,1,1,1,1),a.endGeometry())}else{f.begin();{let t=_[te[ne].blurTextureName],r=a.height/100,n=a.width/2,i=a.height/2,s=4*C*r,l=2*a.height;f.drawRectangleOffCenter(t,n-s,i,s,l,0,0,1,1,1,1,1,1),f.drawRectangleOffCenter(t,n,i,s,l,0,0,1,1,1,1,1,1),f.drawRectangleOffCenter(t,n+s,i,s,l,0,0,1,1,1,1,1,1);let c=_[te[ne].textureName],[h,u]=N(C,0);f.drawRectangleOffCenter(c,a.width/2,a.height/2,h,a.height,0,0,1,1,1,1,1,1)}for(let t of E)t.draw();{let t=A*.5,[r,n]=B(-7,95),[i,s]=N(2*t,2*t);f.drawRectangleOffCenter(_[F.types[Q].texture],r,n,i,s,0,0,1,1,1,1,1,1)}se&&x==="idle"&&S!==null&&Ve();{let[t,r]=B(0,90),[n,i]=N(C,.2);f.drawRectangleOffCenter(_.white,t,r,n,i,0,0,1,1,1,1,1,1)}["start","win","fail"].includes(x)&&(f.drawRectangle(_.white,0,0,a.width,a.height,0,0,1,1,0,0,0,.75),f.drawRotatedRectangleOffCenter(_.rays,a.width/2,a.height/2,a.height*.5,a.height*.5,o/1e4,0,0,1,1,1,1,1,.5)),f.end();{let[t,r]=B(-C/2,0);f.begin(),f.drawRectangle(_[`lang_${T}`],t+10,10,64,64,0,0,1,1,1,1,1,1),f.end()}if(v!==null){Fe.bind().setUniformMatrix("matrix",a.matrix).setUniform("screenPxRange",Math.max(2,32*8/40)).setUniform("outlineBias",.25);let[i,s]=N(C/2,0),l=P.toString().padStart(6,"0")+" ",c=a.measureString(v,l,32);f.begin(),f.drawString(_.font,v,i+a.width/2-c,s,l,32,1,1,1,1),x==="start"?I===1?(f.drawStringOffCenter(_.font,v,a.width/2,a.height/2-32*1.75,D[T].press,32,1,1,1,1),f.drawStringOffCenter(_.font,v,a.width/2,a.height/2-32*.5,D[T].toStartGame,32,1,1,1,1)):(f.drawStringOffCenter(_.font,v,a.width/2,a.height/2-32*.75,D[T].level+" "+I,32,1,1,1,1),f.drawStringOffCenter(_.font,v,a.width/2,a.height/2+32*2.75,D[T].press,32*.75,1,1,1,1),f.drawStringOffCenter(_.font,v,a.width/2,a.height/2+32*3.75,D[T].toContinue,32*.75,1,1,1,1)):x==="win"?(f.drawStringOffCenter(_.font,v,a.width/2,a.height/2-32*.75,D[T].win,32,1,1,1,1),f.drawStringOffCenter(_.font,v,a.width/2,a.height/2+32*2.75,D[T].press,32*.75,1,1,1,1),f.drawStringOffCenter(_.font,v,a.width/2,a.height/2+32*3.75,D[T].toContinue,32*.75,1,1,1,1)):x==="fail"&&(f.drawStringOffCenter(_.font,v,a.width/2,a.height/2-32*.75,D[T].fail,32,1,1,1,1),f.drawStringOffCenter(_.font,v,a.width/2,a.height/2+32*2.75,D[T].press,32*.75,1,1,1,1),f.drawStringOffCenter(_.font,v,a.width/2,a.height/2+32*3.75,D[T].toContinue,32*.75,1,1,1,1)),f.end()}}V.unbind(),V.blit(ye),V.bind(),a.clear(0,0,0,0),Le.bind().setUniformMatrix("matrix",a.matrix),se&&x==="idle"&&S!==null&&(f.begin(),S.draw(),Ve(),f.end()),V.unbind(),V.blit(K);for(let t=0;t<4;t++)Be.bind().setUniform("horizontal",!0),ie.bind(),K.attachment.bind(),a.beginGeometry(),a.drawRectangleOffCenter(0,0,2,2,0,0,1,1,1,1,1,1),a.endGeometry(),ie.unbind(),Be.bind().setUniform("horizontal",!1),K.bind(),ie.attachment.bind(),a.beginGeometry(),a.drawRectangleOffCenter(0,0,2,2,0,0,1,1,1,1,1,1),a.endGeometry(),K.unbind();R.viewport(0,0,a.width,a.height),He.bind().setUniformInteger("blurTexture",1).setUniform("blurBrightness",(Math.sin(8*o/1e3)+1)/2),ye.attachment.bind(),K.attachment.bind(1),a.beginGeometry(),a.drawRectangleOffCenter(0,0,2,2,0,0,1,1,1,1,1,1),a.endGeometry()}function Ve(){let[o,e]=oe(z,X);e=Math.min(e,95);let t=o,r=e-100,[n,i]=ae(t,r),s=S.x,l=S.y,c=E.filter(h=>h.objectType==="Ball");for(let h=1;h<=1e3;h++)if(s+=n/10,l+=i/10,(s-S.radius<-C/2||s+S.radius>C/2)&&(n=-n),h%50===0){for(let d of c)if(Qe(s-d.x,l-d.y)<1.5*A*A)return;let u=A/3,[b,g]=B(s,l),[m,w]=N(2*u,2*u);f.drawRectangleOffCenter(_.circle_05,b,g,m,w,0,0,1,1,1,1,1,1)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ke):ke();})();
