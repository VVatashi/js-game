(()=>{var st=Object.defineProperty;var ot=(o,e,t)=>e in o?st(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Z=(o,e,t)=>ot(o,typeof e!="symbol"?e+"":e,t);var ae=class{constructor(){let e=new AudioContext,t=e.createGain();t.connect(e.destination),t.gain.value=.2,this.context=e,this.gainNode=t}resume(){let{context:e}=this;return e.resume(),this}suspend(){let{context:e}=this;return e.suspend(),this}play(e,t=!1){let{context:n,gainNode:r}=this,i=n.createBufferSource();return i.buffer=e,i.loop=t,i.connect(r),i.start(),this}};var le=class{constructor(e,t,n){let r=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,r),e.renderbufferStorageMultisample(e.RENDERBUFFER,e.getParameter(e.MAX_SAMPLES),e.RGBA8,t,n),this.context=e,this.handle=r,this.width=t,this.height=n}bind(){let{context:e,handle:t}=this;return e.bindRenderbuffer(e.RENDERBUFFER,t),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteRenderbuffer(t),this.handle=null)}},k=class{constructor(e,t,n){let r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.viewport(0,0,t,n),e.bindFramebuffer(e.FRAMEBUFFER,null),this.context=e,this.handle=r,this.width=t,this.height=n}attachTexture(e){let{context:t,attachment:n}=this;return this.bind(),e.bind(),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e.handle,0),this.attachment=e,this.unbind(),n?.delete(),this}attachRenderbuffer(e){let{context:t,attachment:n}=this;return this.bind(),e.bind(),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,e.handle),this.attachment=e,this.unbind(),n?.delete(),this}resize(e,t){let{context:n}=this;return this.bind(),n.viewport(0,0,e,t),this.unbind(),this.width=e,this.height=t,this}bind(){let{context:e,handle:t}=this;return e.bindFramebuffer(e.FRAMEBUFFER,t),this}unbind(){let{context:e}=this;return e.bindFramebuffer(e.FRAMEBUFFER,null),this}blit(e){let{context:t,width:n,height:r}=this;return t.bindFramebuffer(t.READ_FRAMEBUFFER,this.handle),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,e.handle),t.blitFramebuffer(0,0,n,r,0,0,e.width,e.height,t.COLOR_BUFFER_BIT,t.LINEAR),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteFramebuffer(t),this.handle=null)}},ce=class{constructor(e,t,n){let r=e.createShader(t);if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Can't compile shader: "+e.getShaderInfoLog(r));this.context=e,this.handle=r}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteShader(t),this.handle=null)}},j=class{constructor(e,t,n){let r=new ce(e,e.VERTEX_SHADER,t),i=new ce(e,e.FRAGMENT_SHADER,n),s=e.createProgram();if(e.attachShader(s,r.handle),e.attachShader(s,i.handle),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS))throw new Error("Can't link shader program: "+e.getProgramInfoLog(s));r.delete(),i.delete(),this.context=e,this.handle=s,this.uniformLocationCache={}}bind(){let{context:e,handle:t}=this;return e.useProgram(t),this}getUniformLocation(e){let{context:t,handle:n,uniformLocationCache:r}=this;return e in r?r[e]:r[e]=t.getUniformLocation(n,e)}setUniform(e,t){let{context:n}=this;this.bind();let r=this.getUniformLocation(e);return typeof t=="boolean"?n.uniform1i(r,t?1:0):n.uniform1f(r,t),this}setUniformInteger(e,t){let{context:n}=this;this.bind();let r=this.getUniformLocation(e);return n.uniform1i(r,t),this}setUniformMatrix(e,t,n=!1){let{context:r}=this;this.bind();let i=this.getUniformLocation(e);return r.uniformMatrix4fv(i,n,t),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteProgram(t),this.handle=null)}},I=class{constructor(e,t,n,r,i=e.RGBA8){let s=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(t,s),e.texImage2D(t,0,i,n,r,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(t,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(t,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(t,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.LINEAR),this.context=e,this.handle=s,this.type=t}bind(e=0){let{context:t,handle:n,type:r}=this;return t.activeTexture(e+t.TEXTURE0),t.bindTexture(r,n),this}setImage(e){let{context:t,type:n}=this;return this.bind(),t.texSubImage2D(n,0,0,0,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(n,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.generateMipmap(n),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteTexture(t),this.handle=null)}},we=class{constructor(e,t,n,r=e.STATIC_DRAW){let i=e.createBuffer();e.bindBuffer(t,i),e.bufferData(t,n,r),this.context=e,this.handle=i,this.type=t,this.usage=r}bind(){let{context:e,handle:t,type:n}=this;return e.bindBuffer(n,t),this}setData(e){let{context:t,type:n}=this;return this.bind(),t.bufferData(n,e,this.usage),this}setDataRange(e,t,n){let{context:r,type:i}=this;return this.bind(),r.bufferSubData(i,t,e,0,n),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteBuffer(t),this.handle=null)}},$=class{constructor(e,t,n,r,i){this.elements=e,this.type=t,this.normalized=n,this.stride=r,this.offset=i}},xe=class{constructor(e,t,n){let r=e.createVertexArray();e.bindVertexArray(r),t.bind();for(let i=0;i<n.length;i++){e.enableVertexAttribArray(i);let s=n[i];e.vertexAttribPointer(i,s.elements,s.type,s.normalized,s.stride,s.offset)}e.bindVertexArray(null),this.context=e,this.handle=r}bind(){let{context:e,handle:t}=this;return e.bindVertexArray(t),this}unnbind(){let{context:e}=this;return e.bindVertexArray(null),this}draw(e){let{context:t}=this;return this.bind(),t.drawArrays(t.TRIANGLES,0,e),this.unnbind(),this}delete(){let{context:e,handle:t}=this;t!==null&&(e.deleteVertexArray(t),this.handle=null)}},Re=class{constructor(e,t,n,r=e.STATIC_DRAW){let i=0;for(let u of n)i+=u.elements;let s=new we(e,e.ARRAY_BUFFER,new Float32Array(i*t),r),l=new xe(e,s,n);this.context=e,this.vertexCount=t,this.vertexArray=l,this.vertexBuffer=s}setData(e){return this.vertexBuffer.setData(e),this}setDataRange(e,t,n){return this.vertexBuffer.setDataRange(e,t,n),this}draw(e=null){return this.vertexArray.draw(e||this.vertexCount),this}delete(){this.vertexArray.delete(),this.vertexBuffer.delete()}},he=class{constructor(){this.glyphs={}}deserializeDataFromCSV(e,t,n){let r=e.split(`
`);for(let i of r){let s=i.split(",");if(s.length!==10)continue;let l=Number(s[0]),u=Number(s[1]),h=Number(s[2]),d=1-Number(s[3]),b=Number(s[4]),g=1-Number(s[5]),p=Number(s[6])/t,_=1-Number(s[7])/n,c=Number(s[8])/t,m=1-Number(s[9])/n;this.glyphs[l]={charCode:l,advance:u,planeLeft:h,planeBottom:d,planeRight:b,planeTop:g,atlasLeft:p,atlasBottom:_,atlasRight:c,atlasTop:m}}return this}deserializeData(e){let t=new Float32Array(e),n=0,r=t[n++];for(let i=0;i<r;i++){let s=t[n++],l=t[n++],u=t[n++],h=t[n++],d=t[n++],b=t[n++],g=t[n++],p=t[n++],_=t[n++],c=t[n++];this.glyphs[s]={charCode:s,advance:l,planeLeft:u,planeBottom:h,planeRight:d,planeTop:b,atlasLeft:g,atlasBottom:p,atlasRight:_,atlasTop:c}}return this}serializeData(){let e=Object.values(this.glyphs),t=[e.length];for(let n of e){let{charCode:r,advance:i,planeLeft:s,planeBottom:l,planeRight:u,planeTop:h,atlasLeft:d,atlasBottom:b,atlasRight:g,atlasTop:p}=n;t.push(r,i,s,l,u,h,d,b,g,p)}return new Float32Array(t)}},de=class{constructor(e,t,n){Z(this,"MAX_VERTICES",65535);Z(this,"VERTEX_ELEMENTS",8);this.context=e,this.vertices=new Float32Array(this.VERTEX_ELEMENTS*this.MAX_VERTICES),this.mesh=new Re(e,this.MAX_VERTICES,[new $(2,e.FLOAT,!1,8*4,0),new $(2,e.FLOAT,!1,8*4,2*4),new $(4,e.FLOAT,!1,8*4,4*4)],e.DYNAMIC_DRAW),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.resize(t,n)}resize(e,t){return this.width=e,this.height=t,this.matrix=this.createOrthographicOffCenter(0,e,t,0,-1,1),this}createOrthographicOffCenter(e,t,n,r,i,s){let l=1/(e-t),u=1/(n-r),h=1/(i-s),d=-2*l,b=-2*u,g=2*h,p=(e+t)*l,_=(r+n)*u,c=(s+i)*h;return[d,0,0,0,0,b,0,0,0,0,g,0,p,_,c,1]}clear(e,t,n,r){let{context:i}=this;return i.clearColor(e,t,n,r),i.clear(i.COLOR_BUFFER_BIT),this}beginGeometry(){return this.vertexCount=0,this}endGeometry(){let{VERTEX_ELEMENTS:e,vertexCount:t,vertices:n}=this;if(t!==0)return this.mesh.setDataRange(n,0,e*t),this.mesh.draw(t),this}addVertex(e,t,n,r,i,s,l,u){let{VERTEX_ELEMENTS:h,vertexCount:d,vertices:b}=this;for(let g=0;g<h;g++)b[h*d+g]=arguments[g];return this.vertexCount++,this}drawTriangle(e,t,n,r,i,s,l,u,h,d,b,g,p,_,c,m){let{MAX_VERTICES:y,vertexCount:v}=this;return v+3>=y&&this.endGeometry().beginGeometry(),this.addVertex(e,t,n,r,p,_,c,m).addVertex(i,s,l,u,p,_,c,m).addVertex(h,d,b,g,p,_,c,m)}drawQuad(e,t,n,r,i,s,l,u,h,d,b,g,p,_,c,m,y,v,F,L){return this.drawTriangle(e,t,n,r,i,s,l,u,h,d,b,g,y,v,F,L).drawTriangle(e,t,n,r,h,d,b,g,p,_,c,m,y,v,F,L)}drawRectangle(e,t,n,r,i,s,l,u,h,d,b,g){let p=e,_=t,c=e+n,m=t,y=e+n,v=t+r,F=e,L=t+r;return this.drawQuad(p,_,i,s,c,m,l,s,y,v,l,u,F,L,i,u,h,d,b,g)}drawRectangleOffCenter(e,t,n,r,i,s,l,u,h,d,b,g){let p=n/2,_=r/2,c=e-p,m=t-_,y=e+p,v=t-_,F=e+p,L=t+_,q=e-p,oe=t+_;return this.drawQuad(c,m,i,s,y,v,l,s,F,L,l,u,q,oe,i,u,h,d,b,g)}drawRotatedRectangleOffCenter(e,t,n,r,i,s,l,u,h,d,b,g,p){let _=n/2,c=r/2,m=Math.sin(i),y=Math.cos(i),v=-_,F=-c,L=_,q=-c,oe=_,Le=c,Ue=-_,Ne=c,Ze=e+y*v-m*F,$e=t+m*v+y*F,Je=e+y*L-m*q,et=t+m*L+y*q,tt=e+y*oe-m*Le,nt=t+m*oe+y*Le,rt=e+y*Ue-m*Ne,it=t+m*Ue+y*Ne;return this.drawQuad(Ze,$e,s,l,Je,et,u,l,tt,nt,u,h,rt,it,s,h,d,b,g,p)}drawChar(e,t,n,r,i,s,l,u,h){let d=e.glyphs[r];return typeof d>"u"||d===null?this:this.drawRectangle(t+i*d.planeLeft,n+i*d.planeTop,i*(d.planeRight-d.planeLeft),i*(d.planeBottom-d.planeTop),d.atlasLeft,d.atlasTop,d.atlasRight,d.atlasBottom,s,l,u,h)}drawString(e,t,n,r,i,s,l,u,h){let d=0;for(let b=0;b<r.length;b++){let g=r.charCodeAt(b),p=e.glyphs[g];typeof p>"u"||p===null||(this.drawChar(e,t+d,n,g,i,s,l,u,h),d+=i*p.advance)}return this}drawStringOffCenter(e,t,n,r,i,s,l,u,h){let d=this.measureString(e,r,i);return this.drawString(e,t-d/2,n,r,i,s,l,u,h)}measureString(e,t,n){let r=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i),l=e.glyphs[s];typeof l>"u"||l===null||(r+=n*l.advance)}return r}delete(){this.mesh.delete()}},ue=class{constructor(e){this.renderer=e,this.buckets=new Map}begin(){return this.buckets.clear(),this}end(){for(let[e,t]of this.buckets.entries()){e.bind(),this.renderer.beginGeometry();for(let{name:n,args:r}of t)this.renderer[n](...r);this.renderer.endGeometry()}return this}addCommand(e,t,n){let r={name:t,args:n};return this.buckets.has(e)?this.buckets.get(e).push(r):this.buckets.set(e,[r]),this}drawTriangle(e,t,n,r,i,s,l,u,h,d,b,g,p,_,c,m,y){return this.addCommand(e,"drawTriangle",[...arguments].slice(1))}drawQuad(e,t,n,r,i,s,l,u,h,d,b,g,p,_,c,m,y,v,F,L,q){return this.addCommand(e,"drawQuad",[...arguments].slice(1))}drawRectangle(e,t,n,r,i,s,l,u,h,d,b,g,p){return this.addCommand(e,"drawRectangle",[...arguments].slice(1))}drawRectangleOffCenter(e,t,n,r,i,s,l,u,h,d,b,g,p){return this.addCommand(e,"drawRectangleOffCenter",[...arguments].slice(1))}drawRotatedRectangleOffCenter(e,t,n,r,i,s,l,u,h,d,b,g,p,_){return this.addCommand(e,"drawRotatedRectangleOffCenter",[...arguments].slice(1))}drawChar(e,t,n,r,i,s,l,u,h,d){return this.addCommand(e,"drawChar",[...arguments].slice(1))}drawString(e,t,n,r,i,s,l,u,h,d){return this.addCommand(e,"drawString",[...arguments].slice(1))}drawStringOffCenter(e,t,n,r,i,s,l,u,h,d){return this.addCommand(e,"drawStringOffCenter",[...arguments].slice(1))}measureString(e,t,n){return this.renderer.measureString(e,t,n)}};var Se=class{get objectType(){return"GameObject"}update(e){}draw(){}},ye=class ye extends Se{get objectType(){return"Ball"}constructor(e,t,n,r,i,s){super(),this.x=e,this.y=t,this.offsetX=0,this.offsetY=0,this.radius=n,this.velocityX=r,this.velocityY=i,this.type=s}update(e){if(super.update(e),!G)if((x==="idle"||x==="shot")&&(this.x+=this.velocityX*e,this.y+=this.velocityY*e),E!==null&&x==="shot"){let t=E.x-this.x,n=E.y-this.y,r=_e(t,n),[i,s]=se(t,n);r<30?(this.offsetX=.9*this.offsetX+.1*(-250/(t*t+n*n)*i),this.offsetY=.9*this.offsetY+.1*(-250/(t*t+n*n)*s)):(this.offsetX*=.975,this.offsetY*=.975)}else this.offsetX*=.975,this.offsetY*=.975}draw(){super.draw();let e=w[ye.types[this.type].texture],[t,n]=W(this.x,this.y),[r,i]=M(2*this.radius,2*this.radius);f.drawRectangleOffCenter(e,t+this.offsetX,n+this.offsetY,r,i,0,0,1,1,1,1,1,1)}};Z(ye,"types",[{texture:"ball0",score:1},{texture:"ball1",score:2},{texture:"ball2",score:3},{texture:"ball3",score:4},{texture:"ball4",score:5},{texture:"ball5",score:6},{texture:"ball6",score:7},{texture:"ball7",score:8}]);var O=ye,Te=class extends O{get objectType(){return"Projectile"}constructor(e,t,n,r,i,s,l){super(e,t,n,r,i,s,l),this.angle=0}update(e){super.update(e),!G&&((this.x-this.radius<-D/2&&this.velocityX<0||this.x+this.radius>D/2&&this.velocityX>0)&&(this.velocityX=-this.velocityX,Be()),x==="shot"&&(this.angle+=e/100))}draw(){let e=w[O.types[this.type].texture],[t,n]=W(this.x,this.y),[r,i]=M(2*this.radius,2*this.radius);f.drawRotatedRectangleOffCenter(e,t,n,r,i,this.angle,0,0,1,1,1,1,1,1)}},Ce=class extends O{get objectType(){return"Particle"}constructor(e,t,n,r,i,s,l){super(e,t,n,r,i,s,l),this.lifetime=250*Math.random()}update(e){super.update(e),!G&&(this.x+=this.velocityX*e,this.y+=this.velocityY*e,this.velocityY+=2e-6*e*e,this.lifetime-=e,(this.lifetime<=0||this.y-this.radius>100)&&Q(this))}},me=class extends O{get objectType(){return"FallingBall"}constructor(e,t,n,r,i,s,l){super(e,t,n,r,i,s,l),this.lifetime=5e3}update(e){super.update(e),!G&&(this.x+=this.velocityX*e,this.y+=this.velocityY*e,this.velocityY+=2e-6*e*e,this.lifetime-=e,(this.lifetime<=0||this.y-this.radius>100)&&Q(this))}draw(){let e=w[O.types[this.type].texture],[t,n]=W(this.x,this.y),[r,i]=M(2*this.radius,2*this.radius),s=this.lifetime/5e3;f.drawRectangleOffCenter(e,t,n,r,i,0,0,1,1,1,1,1,s)}},ve=class extends O{get objectType(){return"ExplodingBall"}constructor(e,t,n,r,i,s,l){super(e,t,n,r,i,s,l),this.lifetime=200}update(e){super.update(e),!G&&(this.x+=this.velocityX*e,this.y+=this.velocityY*e,this.radius*=1.05,this.lifetime-=e,(this.lifetime<=0||this.y-this.radius>100)&&Q(this))}draw(){let e=w[O.types[this.type].texture],[t,n]=W(this.x,this.y),[r,i]=M(2*this.radius,2*this.radius),s=this.lifetime/200;f.drawRectangleOffCenter(e,t,n,r,i,0,0,1,1,1,1,1,s)}},at=`#version 300 es

uniform mat4 matrix;

layout(location = 0) in vec2 position;
layout(location = 1) in vec2 texCoords;
layout(location = 2) in vec4 color;

out vec2 fragTexCoords;
out vec4 fragColor;

void main() {
    gl_Position = matrix * vec4(position, 0, 1);

    fragTexCoords = texCoords;
    fragColor = color;
}
`,lt=`#version 300 es

precision mediump float;

uniform sampler2D colorTexture;

in vec2 fragTexCoords;
in vec4 fragColor;

out vec4 color;

void main() {
    color = fragColor * texture(colorTexture, fragTexCoords);
}
`,ct=`#version 300 es

uniform mat4 matrix;

layout(location = 0) in vec2 position;
layout(location = 1) in vec2 texCoords;
layout(location = 2) in vec4 color;

out vec2 fragTexCoords;
out vec4 fragColor;

void main() {
    gl_Position = matrix * vec4(position, 0.0, 1.0);

    fragTexCoords = texCoords;
    fragColor = color;
}
`,ht=`#version 300 es

precision mediump float;

uniform sampler2D msdfTexture;
uniform float screenPxRange;
uniform float outlineBias;

in vec2 fragTexCoords;
in vec4 fragColor;

out vec4 color;

float median(float r, float g, float b) {
    return max(min(r, g), min(max(r, g), b));
}

void main() {
    vec4 msd = texture(msdfTexture, fragTexCoords);

    float hardDistance = median(msd.r, msd.g, msd.a);
    float softDistance = msd.a;

    float inner = screenPxRange * (hardDistance - 0.5) + 0.5;
    float outer = screenPxRange * (softDistance - 0.5 + outlineBias) + 0.5;

    float innerOpacity = clamp(inner, 0.0, 1.0);
    float outerOpacity = clamp(outer, 0.0, 1.0);

    color = fragColor * innerOpacity + vec4(vec3(0.0), 1.0) * outerOpacity;
}
`,dt=`#version 300 es

layout(location = 0) in vec2 position;
layout(location = 1) in vec2 texCoords;
layout(location = 2) in vec4 color;

out vec2 fragTexCoords;

void main() {
    gl_Position = vec4(position, 0, 1);

    fragTexCoords = texCoords;
}
`,ut=`#version 300 es

precision mediump float;

const float weight[5] = float[] (0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);

uniform sampler2D colorTexture;
uniform bool horizontal;

in vec2 fragTexCoords;

out vec4 color;

void main() {
    vec2 texelSize = 1.0 / vec2(textureSize(colorTexture, 0));
    vec3 result = texture(colorTexture, fragTexCoords).rgb * weight[0];

    if (horizontal) {
        for (int i = 1; i < 5; i++) {
            result += texture(colorTexture, fragTexCoords + vec2(texelSize.x * float(i), 0.0)).rgb * weight[i];
            result += texture(colorTexture, fragTexCoords - vec2(texelSize.x * float(i), 0.0)).rgb * weight[i];
        }
    } else {
        for (int i = 1; i < 5; i++) {
            result += texture(colorTexture, fragTexCoords + vec2(0.0, texelSize.y * float(i))).rgb * weight[i];
            result += texture(colorTexture, fragTexCoords - vec2(0.0, texelSize.y * float(i))).rgb * weight[i];
        }
    }

    color = vec4(result, 1.0);
}
`,ft=`#version 300 es

layout(location = 0) in vec2 position;
layout(location = 1) in vec2 texCoords;
layout(location = 2) in vec4 color;

out vec2 fragTexCoords;

void main() {
    gl_Position = vec4(position, 0.0, 1.0);

    fragTexCoords = texCoords;
}
`,gt=`#version 300 es

precision mediump float;

uniform sampler2D colorTexture;
uniform sampler2D blurTexture;

uniform float blurBrightness;

in vec2 fragTexCoords;

out vec4 color;

void main() {
    vec3 result = texture(colorTexture, fragTexCoords).rgb + blurBrightness * texture(blurTexture, fragTexCoords).rgb;
    color = vec4(pow(result, vec3(1.0 / 2.2)), 1.0);
}
`,A=null,R=null,Ee=null,Ae=null,ke=null,Oe=null,De=null,w={},T=null,a=null,f=null,Y=null,be=null,ne=null,V=null,z=null,ge=[],mt=0,S=[],K=[],E=null,H=0,x="start",C=4,D=45,P=1,X=0,pe=0,N=0,B=0,re=!1,G=!1,bt="puzzlebobble",je=null,J=[{textureName:"background_0",blurTextureName:"background_0_blur"},{textureName:"background_1",blurTextureName:"background_1_blur"},{textureName:"background_2",blurTextureName:"background_2_blur"}],ee=0,Ve=109;async function pt(o){return(await fetch(o)).arrayBuffer()}function Xe(o){return new Promise(e=>{let t=new Image;t.addEventListener("load",()=>e(t)),t.loading="eager",t.src=o})}async function U(o){let t=await(await fetch(o)).arrayBuffer();return z.context.decodeAudioData(t)}function W(o,e){let t=a.width/2,n=-Ve,r=a.height/100;return[r*o+t,r*e+n]}function ie(o,e){let t=a.width/2,n=-Ve,r=a.height/100;return[(o-t)/r,(e-n)/r]}function M(o,e){let t=a.height/100;return[t*o,t*e]}function He(o,e){return o*o+e*e}function _e(o,e){return Math.sqrt(o*o+e*e)}function se(o,e){let t=_e(o,e);return[o/t,e/t]}function We(){let o=new Set;for(let e of S)e.objectType==="Ball"&&o.add(e.type);return[...o]}function yt(o,e,t){for(let n of o)if(He(e-n.x,t-n.y)<1.25*n.radius*n.radius)return n;return null}function _t(o,e,t,n,r){let i=null,s=0;for(;i===null&&s<128;)i=yt(o,e,t),e+=n*C/2,t+=r*C/2,(e-C<-D/2||e+C>D/2)&&(n=-n),s++;return i}function Ke(){let o=S.filter(r=>r.objectType==="Ball"),e=new Set,t=-5;for(let r=-10;r<10;r++){let[i,s]=se(r,t),l=_t(o,0,90,i,s);l!==null&&e.add(l)}let n=[];for(let r of[...e]){let i=Qe(r).length;for(let s=0;s<i;s++)n.push(r)}return n.map(r=>r.type)}function ze(){let o=Ke();if(o.length===0){let e=We();return e.length===0?0:e[Math.floor(e.length*Math.random())]}return o[Math.floor(o.length*Math.random())]}function Fe(){S=S.filter(t=>t!==E);let o=We(),e=o.length>0&&o.includes(H)?H:ze();H=ze(),S.push(E=new Te(0,95,C,0,0,e))}function fe(){S=[],K=[];let o=-P;for(let e=o;e<5;e++)for(let t=-2;t<(e%2?2:3);t++){let n=Math.floor(Math.min(P+3,O.types.length)*Math.random()),r=new O(2*C*t+(e%2?C:0),C+2*C*e,C,0,5e-4,n);S.push(r),e===o&&K.push(r)}ee=Math.floor(Math.random()*J.length),H=Ke(),Fe()}function Pe(){let{clientWidth:o,clientHeight:e}=A;A.width=o,A.height=e,a.resize(o,e),Y.resize(o,e).attachRenderbuffer(new le(R,o,e)),be.resize(o,e).attachTexture(new I(R,R.TEXTURE_2D,o,e)),ne.resize(o,e).attachTexture(new I(R,R.TEXTURE_2D,o,e)),V.resize(o,e).attachTexture(new I(R,R.TEXTURE_2D,o,e))}async function Ge(){if(A=document.getElementById("canvas"),A===null)return console.error("#canvas not found");if(R=A.getContext("webgl2",{antialias:!1}),R===null)return console.error("Can't create webgl context");Ae=new j(R,at,lt),ke=new j(R,ft,gt),Oe=new j(R,ct,ht),De=new j(R,dt,ut),a=new de(R,A.width,A.height),f=new ue(a),Y=new k(R,A.clientWidth,A.clientHeight),be=new k(R,A.clientWidth,A.clientHeight),ne=new k(R,A.clientWidth,A.clientHeight),V=new k(R,A.clientWidth,A.clientHeight),await Promise.all([...["ball0","ball1","ball2","ball3","ball4","ball5","ball6","ball7","background_0","background_0_blur","background_1","background_1_blur","background_2","background_2_blur","rays","white","blue_button00","circle_05"].map(t=>Xe(`./assets/${t}.png`).then(n=>w[t]=new I(R,R.TEXTURE_2D,n.width,n.height,R.SRGB8_ALPHA8).setImage(n))),Xe("./assets/font.png").then(t=>w.font=new I(R,R.TEXTURE_2D,t.width,t.height,R.RGBA8).setImage(t)),pt("./assets/font.bin").then(t=>T=new he().deserializeData(t))]),document.addEventListener("visibilitychange",function(){document.hidden?(z?.suspend(),G=!0):(z?.resume(),G=!1)}),document.addEventListener("click",t=>{if(z===null&&(z=new ae,z.resume(),Promise.all([U("./assets/impactGlass_light_000.mp3"),U("./assets/impactGlass_light_001.mp3"),U("./assets/impactGlass_light_002.mp3"),U("./assets/impactGlass_light_003.mp3"),U("./assets/impactGlass_light_004.mp3"),U("./assets/impactGlass_medium_000.mp3"),U("./assets/impactGlass_medium_001.mp3"),U("./assets/impactGlass_medium_002.mp3"),U("./assets/impactGlass_medium_003.mp3"),U("./assets/impactGlass_medium_004.mp3")]).then(n=>ge=n)),x==="menu"){N=t.clientX,B=t.clientY;let n=32,[r,i]=M(.8*D,0);N>a.width/2-r/2&&N<a.width/2+r/2&&(B>a.height/2-n-72/2&&B<a.height/2-n+72/2?x="idle":B>a.height/2+n*2-72/2&&B<a.height/2+n*2+72/2&&(P=1,X=0,pe=0,x="idle",fe()))}else x==="start"?x="idle":["win","fail"].includes(x)&&(typeof window.yandexGamesSDK<"u"?(z?.suspend(),G=!0,window.yandexGamesSDK.adv.showFullscreenAdv({callbacks:{onClose(){fe(),z?.resume(),G=!1,x="start"},onError(n){console.error(n)}}})):(fe(),x="start"))}),document.addEventListener("contextmenu",t=>t.preventDefault()),document.addEventListener("pointerdown",t=>{t.preventDefault(),N=t.clientX,B=t.clientY;let[n,r]=ie(N,B);re=t.button===0&&r<90}),document.addEventListener("pointermove",t=>{t.preventDefault(),N=t.clientX,B=t.clientY;let[n,r]=ie(N,B);re=t.buttons===1&&r<90}),document.addEventListener("pointerup",t=>{t.preventDefault(),N=t.clientX,B=t.clientY;let[n,r]=ie(N,B);if(x==="idle"&&t.button===0&&r<90){x="shot";let i=n,s=Math.min(r,95)-100,[l,u]=se(i,s),h=.05;E.velocityX=l*h,E.velocityY=u*h}else if(x==="idle"&&(t.button===2||t.button===0&&r>=90)){let i=E.type;E.type=H,H=i}re=!1}),Pe(),addEventListener("resize",Pe),requestAnimationFrame(qe);let o=Number(localStorage.getItem("last_difficulty")||0);o>1&&(P=o,x="menu");let e=Number(localStorage.getItem("last_score")||0);e>0&&(X=e,pe=e),fe(),console.log("Game ready"),await window.yandexGamesSDKPromise,window.yandexGamesSDK.features.LoadingAPI?.ready(),console.log("Yandex Games SDK ready"),window.yandexGamesSDK.getPlayer({scopes:!1}).then(t=>je=t)}function Ie(o,e=[]){let t=new Set([o]),n=new Set,r=[o];for(;r.length>0;){let i=r.pop(),s=Me(i).filter(l=>!e.includes(l));for(let l of s)n.has(l)||(t.add(l),r.push(l)),n.add(l)}return[...t]}function Qe(o){let e=new Set([o]),t=new Set,n=[o];for(;n.length>0;){let r=n.pop(),i=Me(r);for(let s of i)!t.has(s)&&s.type===r.type&&(e.add(s),n.push(s)),t.add(s)}return[...e]}function Me(o){let e=[];for(let t of S){if(t.objectType!=="Ball"||t===o)continue;_e(o.x-t.x,o.y-t.y)<(t.radius+o.radius)*1.25&&e.push(t)}return e}function Be(){ge.length!==0&&z.play(ge[mt++%ge.length])}var te=new Set;function Q(o){te.add(o)}var wt=1e3/30;function qe(o){requestAnimationFrame(qe);let e=Math.min(Ee!==null?o-Ee:0,wt);Ee=o;for(let t of S)t.update(e);if(x==="idle"){let t=0,n=S.filter(s=>s.objectType==="Ball");for(let s of n)s.y>t&&(t=s.y);let[r,i]=ie(0,0);if(t<i+4*C)for(let s of n)s.y+=e/100}if(x==="shot")for(let t of S){if(t.objectType!=="Ball")continue;let n=E.x-t.x,r=E.y-t.y;if(_e(n,r)<(t.radius+E.radius)*.9){let s=t.x,l=t.y;r*r>n*n?(s+=n>0?t.radius:-t.radius,l+=2*t.radius):s+=n>0?2*t.radius:-2*t.radius,Be();let u=new O(s,l,t.radius,t.velocityX,t.velocityY,E.type);S.push(u);let h=new Set(Qe(u));if(h.size>2){for(let c of[...h]){Q(c),X+=O.types[c.type].score,S.push(new ve(c.x,c.y,C,c.velocityX,c.velocityY,c.type));for(let m=0;m<10;m++){let y=2*Math.random()-1,v=2*Math.random()-1;[y,v]=se(y,v),y*=.025,v*=.025;let F=C*.25;S.push(new Ce(c.x,c.y,F,y,v,c.type))}}let d=0;for(let c of[...h])d+=50+Math.random()*50,setTimeout(Be,d);let b=new Set;for(let c of[...h]){let m=Me(c).filter(y=>!h.has(y));for(let y of m)b.add(y)}let g=new Set,p=new Set(K.filter(c=>!h.has(c)));for(let c of[...b]){let m=Ie(c,[...h]);if(m.filter(y=>p.has(y)).length===0)for(let y of m)g.add(y)}if(g.size)for(let c of[...g]){Q(c),X+=O.types[c.type].score;let m=(2*Math.random()-1)*.001,y=c.velocityY;S.push(new me(c.x,c.y,C,m,y,c.type))}let _=new Set;for(let c of K.filter(m=>!h.has(m)).filter(m=>!g.has(m)))Ie(c,[...h,...g]).length===1&&_.add(c);if(_.size)for(let c of[..._])Q(c),X+=O.types[c.type].score,S.push(new me(c.x,c.y,C,c.velocityX,c.velocityY,c.type))}setTimeout(Fe),x="idle";break}}if(E!==null&&(E.y<0||E.y>100)&&(setTimeout(Fe),x="idle"),te.size&&(S=S.filter(t=>!te.has(t)),K=K.filter(t=>!te.has(t)),te.clear()),x==="idle"){let t=S.filter(n=>n.objectType==="Ball");for(let n of t)if(n.y-n.radius>90){X=pe,x="fail";break}}if(x==="idle"&&S.filter(t=>["Ball","FallingBall","ExplodingBall","Particle"].includes(t.objectType)).length===0&&(P++,pe=X,localStorage.setItem("last_difficulty",P),localStorage.setItem("last_score",X),x="win",je!==null&&typeof window.yandexGamesSDK<"u"&&window.yandexGamesSDK.isAvailableMethod("leaderboards.setLeaderboardScore").then(t=>{t&&window.yandexGamesSDK.getLeaderboards().then(n=>n.setLeaderboardScore(bt,X))})),Y.bind(),a.clear(Math.pow(.63,2.2),Math.pow(.88,2.2),Math.pow(.98,2.2),1),Ae.bind().setUniformMatrix("matrix",a.matrix),x==="menu"){{f.begin();let n=w[J[ee].blurTextureName],r=a.height/100,i=a.width/2,s=a.height/2,l=4*D*r,u=2*a.height;f.drawRectangleOffCenter(n,i-l,s,l,u,0,0,1,1,1,1,1,1),f.drawRectangleOffCenter(n,i,s,l,u,0,0,1,1,1,1,1,1),f.drawRectangleOffCenter(n,i+l,s,l,u,0,0,1,1,1,1,1,1);let h=w[J[ee].textureName],[d,b]=M(D,0);f.drawRectangleOffCenter(h,a.width/2,a.height/2,d,a.height,0,0,1,1,1,1,1,1),f.end()}f.begin(),f.drawRectangle(w.white,0,0,a.width,a.height,0,0,1,1,0,0,0,.75),f.drawRotatedRectangleOffCenter(w.rays,a.width/2,a.height/2,a.height*.5,a.height*.5,o/1e4,0,0,1,1,1,1,1,.5),f.end();let t=32;{let[n,r]=M(.8*D,0);f.begin(),f.drawRectangleOffCenter(w.blue_button00,a.width/2,a.height/2-t*1,n,72,0,0,1,1,1,1,1,1),f.drawRectangleOffCenter(w.blue_button00,a.width/2,a.height/2+t*2,n,72,0,0,1,1,1,1,1,1),f.end()}T!==null&&(Oe.bind().setUniformMatrix("matrix",a.matrix).setUniform("screenPxRange",Math.max(2,t*8/40)).setUniform("outlineBias",.25),w.font.bind(),a.beginGeometry(),a.drawStringOffCenter(T,a.width/2,a.height/2-t*2.25,"\u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C",t,1,1,1,1),a.drawStringOffCenter(T,a.width/2,a.height/2-t*1.25,`\u0423\u0440\u043E\u0432\u0435\u043D\u044C ${P}`,t*.75,1,1,1,1),a.drawStringOffCenter(T,a.width/2,a.height/2+t*1.25,"\u041D\u043E\u0432\u0430\u044F \u0438\u0433\u0440\u0430",t,1,1,1,1),a.endGeometry())}else{f.begin();{let t=w[J[ee].blurTextureName],n=a.height/100,r=a.width/2,i=a.height/2,s=4*D*n,l=2*a.height;f.drawRectangleOffCenter(t,r-s,i,s,l,0,0,1,1,1,1,1,1),f.drawRectangleOffCenter(t,r,i,s,l,0,0,1,1,1,1,1,1),f.drawRectangleOffCenter(t,r+s,i,s,l,0,0,1,1,1,1,1,1);let u=w[J[ee].textureName],[h,d]=M(D,0);f.drawRectangleOffCenter(u,a.width/2,a.height/2,h,a.height,0,0,1,1,1,1,1,1)}for(let t of S)t.draw();{let t=C*.5,[n,r]=W(-7,95),[i,s]=M(2*t,2*t);f.drawRectangleOffCenter(w[O.types[H].texture],n,r,i,s,0,0,1,1,1,1,1,1)}re&&x==="idle"&&E!==null&&Ye();{let[t,n]=W(0,90),[r,i]=M(D,.2);f.drawRectangleOffCenter(w.white,t,n,r,i,0,0,1,1,1,1,1,1)}if(["start","win","fail"].includes(x)&&(f.drawRectangle(w.white,0,0,a.width,a.height,0,0,1,1,0,0,0,.75),f.drawRotatedRectangleOffCenter(w.rays,a.width/2,a.height/2,a.height*.5,a.height*.5,o/1e4,0,0,1,1,1,1,1,.5)),f.end(),T!==null){Oe.bind().setUniformMatrix("matrix",a.matrix).setUniform("screenPxRange",Math.max(2,32*8/40)).setUniform("outlineBias",.25);let[i,s]=M(D/2,0),l=X.toString().padStart(6,"0")+" ",u=a.measureString(T,l,32);f.begin(),f.drawString(w.font,T,i+a.width/2-u,s,l,32,1,1,1,1),x==="start"?P===1?(f.drawStringOffCenter(w.font,T,a.width/2,a.height/2-32*1.75,"\u041D\u0430\u0436\u043C\u0438\u0442\u0435",32,1,1,1,1),f.drawStringOffCenter(w.font,T,a.width/2,a.height/2-32*.5,"\u0447\u0442\u043E\u0431\u044B \u043D\u0430\u0447\u0430\u0442\u044C \u0438\u0433\u0440\u0443",32,1,1,1,1)):(f.drawStringOffCenter(w.font,T,a.width/2,a.height/2-32*.75,"\u0423\u0440\u043E\u0432\u0435\u043D\u044C "+P,32,1,1,1,1),f.drawStringOffCenter(w.font,T,a.width/2,a.height/2+32*2.75,"\u041D\u0430\u0436\u043C\u0438\u0442\u0435",32*.75,1,1,1,1),f.drawStringOffCenter(w.font,T,a.width/2,a.height/2+32*3.75,"\u0447\u0442\u043E\u0431\u044B \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C",32*.75,1,1,1,1)):x==="win"?(f.drawStringOffCenter(w.font,T,a.width/2,a.height/2-32*.75,"\u041F\u043E\u0431\u0435\u0434\u0430",32,1,1,1,1),f.drawStringOffCenter(w.font,T,a.width/2,a.height/2+32*2.75,"\u041D\u0430\u0436\u043C\u0438\u0442\u0435",32*.75,1,1,1,1),f.drawStringOffCenter(w.font,T,a.width/2,a.height/2+32*3.75,"\u0447\u0442\u043E\u0431\u044B \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C",32*.75,1,1,1,1)):x==="fail"&&(f.drawStringOffCenter(w.font,T,a.width/2,a.height/2-32*.75,"\u041F\u043E\u0440\u0430\u0436\u0435\u043D\u0438\u0435",32,1,1,1,1),f.drawStringOffCenter(w.font,T,a.width/2,a.height/2+32*2.75,"\u041D\u0430\u0436\u043C\u0438\u0442\u0435",32*.75,1,1,1,1),f.drawStringOffCenter(w.font,T,a.width/2,a.height/2+32*3.75,"\u0447\u0442\u043E\u0431\u044B \u043F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C",32*.75,1,1,1,1)),f.end()}}Y.unbind(),Y.blit(be),Y.bind(),a.clear(0,0,0,0),Ae.bind().setUniformMatrix("matrix",a.matrix),re&&x==="idle"&&E!==null&&(f.begin(),E.draw(),Ye(),f.end()),Y.unbind(),Y.blit(V);for(let t=0;t<4;t++)De.bind().setUniform("horizontal",!0),ne.bind(),V.attachment.bind(),a.beginGeometry(),a.drawRectangleOffCenter(0,0,2,2,0,0,1,1,1,1,1,1),a.endGeometry(),ne.unbind(),De.bind().setUniform("horizontal",!1),V.bind(),ne.attachment.bind(),a.beginGeometry(),a.drawRectangleOffCenter(0,0,2,2,0,0,1,1,1,1,1,1),a.endGeometry(),V.unbind();R.viewport(0,0,a.width,a.height),ke.bind().setUniformInteger("blurTexture",1).setUniform("blurBrightness",(Math.sin(8*o/1e3)+1)/2),be.attachment.bind(),V.attachment.bind(1),a.beginGeometry(),a.drawRectangleOffCenter(0,0,2,2,0,0,1,1,1,1,1,1),a.endGeometry()}function Ye(){let[o,e]=ie(N,B);e=Math.min(e,95);let t=o,n=e-100,[r,i]=se(t,n),s=E.x,l=E.y,u=S.filter(h=>h.objectType==="Ball");for(let h=1;h<=1e3;h++)if(s+=r/10,l+=i/10,(s-E.radius<-D/2||s+E.radius>D/2)&&(r=-r),h%50===0){for(let c of u)if(He(s-c.x,l-c.y)<1.5*C*C)return;let d=C/3,[b,g]=W(s,l),[p,_]=M(2*d,2*d);f.drawRectangleOffCenter(w.circle_05,b,g,p,_,0,0,1,1,1,1,1,1)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ge):Ge();})();
